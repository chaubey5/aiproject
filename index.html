
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Trend Tracker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #ff4081;
            --secondary-color: #9c27b0;
            --accent-color: #6366f1;
            --light-bg: #fcf8fb;
            --dark-bg: #1a1a1a;
            --text-light: #ffffff;
            --text-dark: #2d2d2d;
            --gradient: linear-gradient(135deg, #ff4081 0%, #9c27b0 100%);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .dark-mode {
            background-color: var(--dark-bg);
            color: var(--text-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 1rem;
            height: 100vh;
        }

        header {
            grid-column: span 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            background: var(--gradient);
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .sidebar {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .side-section {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 1rem;
        }
        
        .side-section:last-child {
            border-bottom: none;
        }
        
        .side-section h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .category-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.5rem;
            border: none;
            border-radius: 0.25rem;
            background-color: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            color: inherit;
        }
        
        .category-btn:hover {
            background-color: #f3f4f6;
        }
        
        .dark-mode .category-btn:hover {
            background-color: #3d3d3d;
        }
        
        .note-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
            background-color: #f3f4f6;
            cursor: pointer;
        }
        
        .dark-mode .note-item {
            background-color: #3d3d3d;
        }
        
        .note-item:hover {
            background-color: #e5e7eb;
        }
        
        .dark-mode .note-item:hover {
            background-color: #4d4d4d;
        }
        
        .note-delete {
            color: #ef4444;
            background: none;
            border: none;
            cursor: pointer;
        }
        
        .history-item {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
            background-color: #f3f4f6;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.875rem;
        }
        
        .dark-mode .history-item {
            background-color: #3d3d3d;
        }
        
        .history-item:hover {
            background-color: #e5e7eb;
        }
        
        .dark-mode .history-item:hover {
            background-color: #4d4d4d;
        }

        .dark-mode .sidebar {
            background-color: #2d2d2d;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px);
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .dark-mode .chat-container {
            background-color: #2d2d2d;
        }
        
        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--secondary-color);
        }
        
        .status-indicator {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: var(--secondary-color);
        }
        
        .messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            position: relative;
            max-width: 70%;
            padding: 1.25rem;
            border-radius: var(--border-radius);
            line-height: 1.5;
            animation: slideIn 0.3s ease-out;
            transition: transform 0.2s ease;
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--gradient);
            color: white;
        }
        
        .ai-message {
            align-self: flex-start;
            background-color: #f3f4f6;
            color: var(--text-dark);
        }
        
        .dark-mode .ai-message {
            background-color: #3d3d3d;
            color: var(--text-light);
        }
        
        .chat-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            background-color: white;
        }
        
        .dark-mode .chat-input {
            background-color: #2d2d2d;
        }
        
        #user-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--accent-color);
            border-radius: var(--border-radius);
            outline: none;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        #user-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(255, 64, 129, 0.3);
        }
        
        .dark-mode #user-input {
            background-color: #3d3d3d;
            color: var(--text-light);
            border-color: #4d4d4d;
        }

        .hidden {
            display: none;
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 0.75rem 1rem;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 0.375rem;
            box-shadow: var(--shadow);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
        }
        
        .dark-mode .modal-content {
            background-color: #2d2d2d;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
        }
        
        .dark-mode .form-input {
            background-color: #3d3d3d;
            color: var(--text-light);
            border-color: #4d4d4d;
        }
        
        .form-btn {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 0.375rem;
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            cursor: pointer;
            margin-top: 1rem;
        }
        
        .form-btn:hover {
            opacity: 0.9;
        }

        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gradient);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        .trend-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background-color: var(--accent-color);
            color: white;
            font-size: 0.75rem;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
        }
        
        .trend-image {
            max-width: 100%;
            border-radius: 0.375rem;
            margin: 0.5rem 0;
        }

        .trend-card {
            background: var(--gradient);
            color: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            header {
                grid-column: span 1;
            }
            
            .sidebar {
                display: none;
            }
            
            .sidebar.active {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                width: 80%;
                height: 100vh;
                z-index: 100;
            }
            
            .message {
                max-width: 85%;
            }
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/>
                </svg>
                Fashion Pulse
            </div>
            <div class="controls">
                <button id="theme-toggle" class="btn">
                    <svg id="light-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                    <svg id="dark-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="hidden">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                    <span id="theme-text">Dark Mode</span>
                </button>
                <button id="add-note" class="btn">Save Trend</button>
                <button id="clear-chat" class="btn">Clear Chat</button>
            </div>
        </header>

        <aside class="sidebar">
            <div class="side-section">
                <h3>Trend Categories</h3>
                <button class="category-btn" data-category="womens">Women's Fashion</button>
                <button class="category-btn" data-category="mens">Men's Fashion</button>
                <button class="category-btn" data-category="streetwear">Streetwear</button>
                <button class="category-btn" data-category="luxury">Luxury</button>
            </div>
            
            <div class="side-section">
                <h3>Saved Trends</h3>
                <div id="notes-list"></div>
            </div>
            
            <!-- Chat History section will be added dynamically -->
        </aside>

        <main class="chat-container">
            <div class="messages" id="messages">
                <div class="message ai-message">
                    Welcome to Fashion Pulse! 🌟 Discover the latest trends, get styling tips, 
                    and explore fashion insights. Try asking about seasonal trends or specific styles!
                </div>
            </div>
            
            <form class="chat-input" id="chat-form">
                <input type="text" id="user-input" placeholder="Ask about fashion trends...">
                <button type="submit" class="btn">Send</button>
            </form>
            
            <div class="fab" id="trend-prediction">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/>
                </svg>
            </div>
        </main>
    </div>
    
    <!-- Note Modal -->
    <div class="modal" id="note-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Save Fashion Trend</h3>
                <button class="close-modal" id="close-note-modal">&times;</button>
            </div>
            <form id="note-form">
                <div class="form-group">
                    <label for="note-title" class="form-label">Title</label>
                    <input type="text" id="note-title" class="form-input" placeholder="e.g. Summer 2024 Color Trends" required>
                </div>
                <div class="form-group">
                    <label for="note-content" class="form-label">Details</label>
                    <textarea id="note-content" class="form-input" rows="4" placeholder="Write trend details here..." required></textarea>
                </div>
                <button type="submit" class="form-btn">Save Trend</button>
            </form>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Global variables
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyA2D4LBa47Am8PT2ozqFYM_vj2XNlUi3FE";
        let chatHistory = [];
        let notes = [];
        
        // Create menu toggle button for mobile
        const menuToggle = document.createElement('button');
        menuToggle.id = 'menu-toggle';
        menuToggle.className = 'btn hidden';
        menuToggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>';
        document.querySelector('.controls').prepend(menuToggle);
        
        // Create history list
        const historyList = document.createElement('div');
        historyList.id = 'history-list';
        const historySection = document.createElement('div');
        historySection.className = 'side-section';
        historySection.innerHTML = '<h3>Chat History</h3>';
        historySection.appendChild(historyList);
        document.querySelector('.sidebar').appendChild(historySection);
        
        // Fashion Trend Tracker custom prompt
        const SYSTEM_PROMPT = `You are a Fashion Trend Tracker AI, an expert on the latest fashion trends worldwide. Follow these guidelines:

1. For trend-related questions:
   - Provide a concise trend description.
   - List 3-4 key pieces or styles with bullet points.
   - Mention relevant designers, brands, or celebrities.
   - Share styling tips and seasonal relevance.

2. For specific fashion categories (women's, men's, streetwear, etc.):
   - Focus on the latest trends in that category.
   - Suggest outfit combinations.
   - Recommend accessible brands at different price points.

3. General rules:

   - Be conversational and enthusiastic about fashion.
   - Use fashion terminology appropriately.
   - When mentioning colors, describe them precisely (e.g., "sage green" not just "green").
   - Reference relevant fashion weeks, runway shows, or celebrity style moments.
   - Suggest sustainable alternatives when applicable.`;

        // DOM Elements
        const messagesContainer = document.getElementById('messages');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const themeToggle = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('light-icon');
        const darkIcon = document.getElementById('dark-icon');
        const themeText = document.getElementById('theme-text');
        const addNoteBtn = document.getElementById('add-note');
        const noteModal = document.getElementById('note-modal');
        const closeNoteModal = document.getElementById('close-note-modal');
        const noteForm = document.getElementById('note-form');
        const notesList = document.getElementById('notes-list');
        const clearChatBtn = document.getElementById('clear-chat');
        const toast = document.getElementById('toast');
        const sidebar = document.querySelector('.sidebar');
        const categoryBtns = document.querySelectorAll('.category-btn');
        
        // Initialize the app
        function init() {
            // Check for saved theme
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
                themeText.textContent = 'Light Mode';
            }
            
            // Load chat history
            const savedHistory = localStorage.getItem('chatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
                renderChatHistory();
                
                // Render the last conversation
                const lastConversation = findLastConversation();
                if (lastConversation && lastConversation.length > 0) {
                    // Clear the welcome message
                    messagesContainer.innerHTML = '';
                    
                    lastConversation.forEach(msg => {
                        addMessage(msg.role === 'user' ? 'user' : 'ai', msg.content);
                    });
                }
            }
            
            // Load notes (saved trends)
            const savedNotes = localStorage.getItem('notes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                renderNotes();
            }
            
            // Check if mobile
            if (window.innerWidth <= 768) {
                menuToggle.classList.remove('hidden');
            }
            
            // Event listeners
            window.addEventListener('resize', handleResize);
            
            // Event delegation for dynamically created elements
            document.addEventListener('click', handleDocumentClick);
        }
        
        // Event Listeners
        chatForm.addEventListener('submit', handleChatSubmit);
        themeToggle.addEventListener('click', toggleTheme);
        addNoteBtn.addEventListener('click', openNoteModal);
        closeNoteModal.addEventListener('click', closeModal);
        noteForm.addEventListener('submit', handleNoteSubmit);
        clearChatBtn.addEventListener('click', clearChat);
        menuToggle.addEventListener('click', toggleSidebar);
        
        // Add event listeners to category buttons
        categoryBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const category = btn.dataset.category;
                handleCategoryClick(category);
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            });
        });
        
        // Handle document clicks (event delegation)
        function handleDocumentClick(e) {
            // Handle note deletion
            if (e.target.classList.contains('note-delete') || e.target.closest('.note-delete')) {
                const noteId = e.target.closest('.note-item').dataset.id;
                deleteNote(noteId);
                e.stopPropagation(); // Prevent opening the note
            }
            
            // Handle note item click
            else if (e.target.closest('.note-item')) {
                const noteId = e.target.closest('.note-item').dataset.id;
                viewNote(noteId);
            }
            
            // Handle history item click
            else if (e.target.closest('.history-item')) {
                const historyId = e.target.closest('.history-item').dataset.id;
                loadConversation(historyId);
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            }
        }
        
        // Handle category button click
        function handleCategoryClick(category) {
            let query = "";
            
            switch(category) {
                case "womens":
                    query = "What are the latest women's fashion trends this season?";
                    break;
                case "mens":
                    query = "What are the latest men's fashion trends this season?";
                    break;
                case "streetwear":
                    query = "What are the popular streetwear trends right now?";
                    break;
                case "luxury":
                    query = "What are the current luxury fashion trends?";
                    break;
                default:
                    query = "What are the biggest fashion trends right now?";
            }
            
            // Set the input value and submit the form
            userInput.value = query;
            chatForm.dispatchEvent(new Event('submit'));
        }
        
        // Handle Chat Submit
        async function handleChatSubmit(e) {
            e.preventDefault();
            const message = userInput.value.trim();
            if (!message) return;
            
            // Add user message to UI
            addMessage('user', message);
            userInput.value = '';
            
            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.classList.add('message', 'ai-message');
            typingIndicator.id = 'typing-indicator';
            typingIndicator.textContent = 'Searching trends...';
            messagesContainer.appendChild(typingIndicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            try {
                // Prepare context from chat history (last 10 messages)
                const recentMessages = chatHistory.slice(-10).map(msg => {
                    return {
                        role: msg.role === 'user' ? 'user' : 'model',
                        parts: [{ text: msg.content }]
                    };
                });
                
                // Add system prompt
                const conversation = [
                    {
                        role: 'model',
                        parts: [{ text: SYSTEM_PROMPT }]
                    },
                    ...recentMessages,
                    {
                        role: 'user',
                        parts: [{ text: message }]
                    }
                ];
                
                // Prepare request
                const requestBody = {
                    contents: conversation,
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 2048
                    }
                };

                // Send request to API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const data = await response.json();
                let aiResponse = data.candidates[0].content.parts[0].text;
                
                // Format the response for better readability
                aiResponse = formatChatbotResponse(aiResponse);

                // Remove typing indicator
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) typingIndicator.remove();

                // Add AI message to UI
                addMessage('ai', aiResponse);

                // Update chat history
                chatHistory.push({ 
                    role: 'user', 
                    content: message,
                    conversationId: new Date().toISOString().split('T')[0]
                });
                chatHistory.push({ 
                    role: 'ai', 
                    content: aiResponse,
                    conversationId: new Date().toISOString().split('T')[0]
                });
                
                saveChatHistory();
                renderChatHistory();

            } catch (error) {
                console.error('Error:', error);
                
                // Remove typing indicator
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) typingIndicator.remove();
                
                // Show error message as AI message
                addMessage('ai', "I'm sorry, but I encountered an error while searching for fashion trends. Please check your internet connection and try again.");
                
                // Show toast notification
                showToast("Connection error. Please check your internet connection.");
            }
        }

        // Add message to UI
        function addMessage(sender, content) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', `${sender}-message`);
            
            // Parse potential trend tags and format them
            let formattedContent = content;
            
            // Check for fashion-related terms to highlight as trend tags
            const fashionTerms = [
                'bohemian', 'streetwear', 'Y2K', 'minimalist', 'maximalist', 
                'cottagecore', 'athleisure', 'vintage', 'monochrome', 'sustainable',
                'upcycled', 'oversized', 'retro', 'preppy', 'casual chic', 
                , 'avant-garde', 'pastel', 'neon', 'earth tones'
            ];
            
            if (sender === 'ai') {
                fashionTerms.forEach(term => {
                    const regex = new RegExp(`\\b${term}\\b`, 'gi');
                    formattedContent = formattedContent.replace(regex, `<span class="trend-tag">$&</span>`);
                });
            }
            
            messageDiv.innerHTML = formattedContent;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Save chat history to local storage
        function saveChatHistory() {
            // Group messages into conversations (by dates)
            const conversationId = new Date().toISOString().split('T')[0];
            const conversationIndex = chatHistory.findIndex(msg => msg.conversationId === conversationId);
            
            if (conversationIndex === -1) {
                // Add conversation ID to each message that doesn't have one
                chatHistory.forEach(msg => {
                    if (!msg.conversationId) {
                        msg.conversationId = conversationId;
                    }
                });
            }
            
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }

        // Render chat history in sidebar
        function renderChatHistory() {
            historyList.innerHTML = '';
            
            // Group messages by conversation ID
            const conversations = {};
            chatHistory.forEach(msg => {
                if (msg.conversationId) {
                    if (!conversations[msg.conversationId]) {
                        conversations[msg.conversationId] = [];
                    }
                    conversations[msg.conversationId].push(msg);
                }
            });
            
            // Display the last message of each conversation (up to 10)
            Object.keys(conversations).slice(-10).forEach(id => {
                const conversation = conversations[id];
                const firstUserMsg = conversation.find(msg => msg.role === 'user');
                
                if (firstUserMsg) {
                    const historyItem = document.createElement('div');
                    historyItem.classList.add('history-item');
                    historyItem.dataset.id = id;
                    
                    // Format date
                    const date = new Date(id);
                    const formattedDate = date.toLocaleDateString();
                    
                    historyItem.innerHTML = `
                        <strong>${formattedDate}</strong>: ${firstUserMsg.content.substring(0, 30)}${firstUserMsg.content.length > 30 ? '...' : ''}
                    `;
                    
                    historyList.appendChild(historyItem);
                }
            });
        }

        // Find the last conversation
        function findLastConversation() {
            // Group messages by conversation ID
            const conversations = {};
            chatHistory.forEach(msg => {
                if (msg.conversationId) {
                    if (!conversations[msg.conversationId]) {
                        conversations[msg.conversationId] = [];
                    }
                    conversations[msg.conversationId].push(msg);
                }
            });
            
            // Get the last conversation
            const conversationIds = Object.keys(conversations);
            if (conversationIds.length > 0) {
                const lastId = conversationIds[conversationIds.length - 1];
                return conversations[lastId];
            }
            
            return null;
        }

        // Load a conversation by ID
        function loadConversation(id) {
            // Clear messages container
            messagesContainer.innerHTML = '';
            
            // Filter messages by conversation ID
            const conversation = chatHistory.filter(msg => msg.conversationId === id);
            
            // Render messages
            conversation.forEach(msg => {
                addMessage(msg.role === 'user' ? 'user' : 'ai', msg.content);
            });
        }

        // Toggle theme
        function toggleTheme() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            
            if (isDarkMode) {
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
                themeText.textContent = 'Light Mode';
                localStorage.setItem('theme', 'dark');
            } else {
                lightIcon.classList.remove('hidden');
                darkIcon.classList.add('hidden');
                themeText.textContent = 'Dark Mode';
                localStorage.setItem('theme', 'light');
            }
        }

        // Open note modal
        function openNoteModal() {
            noteModal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            noteModal.classList.remove('active');
        }

        // Handle note submission
        function handleNoteSubmit(e) {
            e.preventDefault();
            
            const titleInput = document.getElementById('note-title');
            const contentInput = document.getElementById('note-content');
            
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();
            
            if (!title || !content) return;
            
            // Create note object
            const note = {
                id: Date.now().toString(),
                title,
                content,
                date: new Date().toLocaleDateString()
            };
            
            // Add note
            notes.push(note);
            
            // Save notes
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Render notes
            renderNotes();
            
            // Reset form
            titleInput.value = '';
            contentInput.value = '';
            
            // Close modal
            closeModal();
            
            // Show toast notification
            showToast('Fashion trend saved successfully!');
        }

        // Render notes
        function renderNotes() {
            notesList.innerHTML = '';
            
            notes.forEach(note => {
                const noteItem = document.createElement('div');
                noteItem.classList.add('note-item');
                noteItem.dataset.id = note.id;
                
                noteItem.innerHTML = `
                    <span>${note.title}</span>
                    <button class="note-delete">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                    </button>
                `;
                
                notesList.appendChild(noteItem);
            });
        }

        // View note
        function viewNote(id) {
            const note = notes.find(note => note.id === id);
            
            if (note) {
                // Add user message
                addMessage('user', `Show me details about the "${note.title}" trend`);
                
                // Add AI message with note content
                addMessage('ai', `
                    <strong>${note.title}</strong>
                    <p><small>Saved on ${note.date}</small></p>
                    <p>${note.content}</p>
                `);
                
                // Update chat history
                chatHistory.push({ 
                    role: 'user', 
                    content: `Show me details about the "${note.title}" trend`,
                    conversationId: new Date().toISOString().split('T')[0]
                });
                chatHistory.push({ 
                    role: 'ai', 
                    content: `<strong>${note.title}</strong><p><small>Saved on ${note.date}</small></p><p>${note.content}</p>`,
                    conversationId: new Date().toISOString().split('T')[0]
                });
                saveChatHistory();
                renderChatHistory();
                
                // Hide sidebar on mobile
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            }
        }

        // Delete note
        function deleteNote(id) {
            notes = notes.filter(note => note.id !== id);
            
            // Save notes
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Render notes
            renderNotes();
            
            // Show toast notification
            showToast('Fashion trend deleted!');
        }

        // Clear chat
        function clearChat() {
            // Clear messages container
            messagesContainer.innerHTML = '';
            
            // Add welcome message
            addMessage('ai', "Welcome to Fashion Trend Tracker! I'm your personal fashion assistant, here to keep you updated on the latest trends, styles, and fashion inspirations. Whether you're looking for outfit ideas, seasonal trends, or fashion advice, I'm here to help. What fashion topic would you like to explore today?");
        }

        // Show toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Toggle sidebar
        function toggleSidebar() {
            sidebar.classList.toggle('active');
        }

        // Handle window resize
        function handleResize() {
            if (window.innerWidth <= 768) {
                menuToggle.classList.remove('hidden');
            } else {
                menuToggle.classList.add('hidden');
                sidebar.classList.remove('active');
            }
        }

        // Format chatbot responses to be shorter and more concise
// Format chatbot responses to be shorter and more concise
function formatChatbotResponse(rawText) {
    // Add line breaks after each period (for sentences)
    let formatted = rawText.replace(/\.\s+/g, ".<br>");
    
    // Also add line break after last sentence if it ends with a period
    formatted = formatted.replace(/\.$/g, ".<br>");
    
    // Format Markdown-style to HTML
    formatted = formatted
        .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>")        // Bold
        .replace(/\*(.*?)\*/g, "<i>$1</i>")            // Italic
        .replace(/(?:^|\n)[•*-] (.*?)(?=\n|$)/g, "<li>$1</li>"); // Bullet

    // Wrap bullets in <ul> if any <li> exists
    if (formatted.includes("<li>")) {
        formatted = "<ul>" + formatted + "</ul>";
    }

    return formatted;
}
        // Trend prediction button click handler
        document.getElementById('trend-prediction').addEventListener('click', function() {
            const trendPrompt = "What is the hottest fashion trend right now that will be popular in the next season?";
            userInput.value = trendPrompt;
            chatForm.dispatchEvent(new Event('submit'));
        });

        // Initialize the app
        init();
    </script>
</body>
</html>
